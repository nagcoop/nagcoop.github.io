<!doctype html>
<html lang="pt-BR">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="theme-color" content="#0b0f12" />
  <title>Nagcoop â€¢ Web Emulator</title>

  <!-- AdSense (opcional aqui tambÃ©m) -->
  <script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-4819258401008864" crossorigin="anonymous"></script>

  <!-- Fonte + estilo dark -->
  <link href="https://fonts.googleapis.com/css2?family=Metal+Mania&display=swap" rel="stylesheet">
  <style>
    :root{
      --bg:#0b0f12; --panel:#12171d; --muted:#9aa4af;
      --brand:#ffd166; --line:#9f1239; --ar: 4 / 3; /* aspect padrÃ£o 4:3 */
    }
    *{box-sizing:border-box}
    html,body{margin:0;background:var(--bg);color:#e5e7eb;font-family:system-ui,-apple-system,Segoe UI,Roboto,Ubuntu,'Helvetica Neue',Arial}
    a{color:#ffd166;text-decoration:none}
    .wrap{max-width:1100px;margin:auto;padding:16px}

    header{border-bottom:2px solid var(--line);background:linear-gradient(180deg,rgba(159,18,57,.15),transparent)}
    .brand{display:flex;align-items:center;gap:12px}
    .brand h1{font-family:'Metal Mania', cursive;letter-spacing:.5px;color:var(--brand);margin:0}
    .brand img{height:48px;border:2px solid var(--line);border-radius:8px}
    nav a{margin-left:16px}
    nav a[aria-current="page"]{text-decoration:underline;text-underline-offset:6px}

    .panel{background:var(--panel);border:1px solid #222a33;border-radius:12px;padding:14px}
    .muted{color:var(--muted);font-size:.95rem}

    .controls{display:flex;flex-wrap:wrap;gap:8px;margin:10px 0}
    .controls > *{font:inherit}
    .btn{padding:9px 14px;border-radius:10px;border:1px solid #2a3340;background:#171e26;color:#e5e7eb;cursor:pointer;transition:transform .08s ease}
    .btn:hover{transform:translateY(-1px)}
    select,input[type="file"],input[type="url"]{background:#0f141a;color:#e5e7eb;border:1px solid #2a3340;border-radius:10px;padding:9px 10px}

    .player{position:relative;width:100%;background:#000;border:1px solid #222a33;border-radius:12px;overflow:hidden;aspect-ratio:var(--ar);max-height:78vh}
    #game{position:absolute;inset:0}

    .tip{margin:8px 0 0}
    .hidden{display:none}

    footer{border-top:1px solid #1b222c;color:#9aa4af;padding:24px 0;margin-top:24px}

    @media (max-width:620px){
      nav{display:flex;gap:12px}
      .controls{flex-direction:column;align-items:stretch}
      .btn,select,input[type="file"],input[type="url"]{width:100%}
    }
  </style>
</head>
<body>
  <header>
    <div class="wrap" style="display:flex;align-items:center;justify-content:space-between">
      <div class="brand">
        <img src="/assets/logo.jpg" alt="Nagcoop">
        <div>
          <h1>Nagcoop</h1>
          <div class="muted" style="margin-top:-6px">Games & News â€¢ Web Emulator</div>
        </div>
      </div>
      <nav>
        <a href="/">Home</a>
        <a href="/downloads.html">Downloads</a>
        <a href="/emulator.html" aria-current="page">Emulator</a>
        <a href="https://www.youtube.com/@Nagcoop" target="_blank" rel="noopener">YouTube</a>
      </nav>
    </div>
  </header>

  <main class="wrap">
    <section class="panel">
      <h2 style="font-family:'Metal Mania',cursive;margin:10px 0">ðŸŽ® Web Emulator</h2>
      <p class="muted">Use apenas backups/homebrews legais. Nada Ã© enviado: a ROM roda sÃ³ no seu navegador.</p>

      <div class="controls">
        <label class="muted">Console:</label>
        <select id="core">
          <optgroup label="Nintendo">
            <option value="nes">NES</option>
            <option value="snes">SNES</option>
            <option value="n64">Nintendo 64</option>
            <option value="gb">Game Boy</option>
            <option value="gbc">Game Boy Color</option>
            <option value="gba" selected>Game Boy Advance</option>
          </optgroup>
        </select>

        <select id="coreSega">
          <optgroup label="SEGA">
            <option value="segaMD">Mega Drive / Genesis</option>
            <option value="segaMS">Master System</option>
            <option value="segaGG">Game Gear</option>
          </optgroup>
        </select>

        <select id="coreSony">
          <optgroup label="Sony">
            <option value="psx">PlayStation (PS1)</option>
            <option value="ps2" disabled>PlayStation 2 â€” nÃ£o suportado no navegador</option>
          </optgroup>
        </select>

        <input type="file" id="rom" accept=".bin,.gen,.md,.smd,.sms,.gg,.nes,.smc,.sfc,.z64,.n64,.v64,.gb,.gbc,.gba,.chd,.cue,.iso,.rom,.zip" />
        <button class="btn" id="btn-run">Rodar ROM local</button>

        <input type="url" id="romUrl" placeholder="ou cole um link direto da ROM (https://...)" />
        <button class="btn" id="btn-run-url">Rodar via URL</button>

        <button class="btn" id="btn-demo">Carregar demo</button>
        <button class="btn" id="btn-full">Tela cheia</button>
      </div>

      <!-- BIOS sÃ³ para PS1 -->
      <div class="controls hidden" id="biosRow">
        <label class="muted">BIOS PS1 (ex.: scph1001.bin):</label>
        <input type="file" id="bios" accept=".bin,.rom,.zip" />
      </div>

      <div class="player" id="playerBox"><div id="game"></div></div>

      <div class="tip muted" id="tip"></div>
    </section>
  </main>

  <footer class="wrap">Â© 2025 Nagcoop â€¢ Gamepad virtual no mobile â€¢ Tema dark ðŸ¤˜</footer>

  <script>
    // ===== CONFIG DO LOADER (CDN OFICIAL) =====
    const EJS_CDN = "https://cdn.emulatorjs.org/stable/data/"; // loader e /data/ precisam vir do MESMO host!

    // ===== ELEMENTOS =====
    const box       = document.getElementById('playerBox');
    const gameDiv   = document.getElementById('game');
    const tipEl     = document.getElementById('tip');
    const coreNin   = document.getElementById('core');
    const coreSeg   = document.getElementById('coreSega');
    const coreSony  = document.getElementById('coreSony');
    const romFile   = document.getElementById('rom');
    const romUrl    = document.getElementById('romUrl');
    const biosRow   = document.getElementById('biosRow');
    const biosFile  = document.getElementById('bios');
    const btnRun    = document.getElementById('btn-run');
    const btnRunUrl = document.getElementById('btn-run-url');
    const btnDemo   = document.getElementById('btn-demo');
    const btnFull   = document.getElementById('btn-full');

    // ===== MAPAS =====
    // Aspect ratio por core (melhor visual)
    const ASPECT = {
      nes: "4 / 3",
      snes:"4 / 3",
      n64: "4 / 3",
      gb:  "10 / 9",
      gbc: "10 / 9",
      gba: "3 / 2",
      segaMD:"4 / 3",
      segaMS:"4 / 3",
      segaGG:"4 / 3",
      psx: "4 / 3"
    };

    // Dicas por core (extensÃµes mais confiÃ¡veis)
    const HINT = {
      nes:  "NES: .nes",
      snes: "SNES: .sfc/.smc",
      n64:  "N64: .z64/.n64/.v64",
      gb:   "GB: .gb",
      gbc:  "GBC: .gbc",
      gba:  "GBA: .gba",
      segaMD:"Mega Drive: .bin/.gen (evite .md/.smd)",
      segaMS:"Master System: .sms",
      segaGG:"Game Gear: .gg",
      psx:  "PS1: .chd (preferÃ­vel) ou .bin/.cue/.iso + BIOS (scph1001.bin)."
    };

    // Demos (homebrews/roms pÃºblicas para testar que o core estÃ¡ ok)
    const DEMOS = {
      nes:   "https://demo.emulatorjs.org/roms/nes/Contra%20(U).nes",
      snes:  "https://demo.emulatorjs.org/roms/snes/F-Zero%20(USA).sfc",
      n64:   "https://demo.emulatorjs.org/roms/n64/Super%20Mario%2064%20(USA).n64",
      gb:    "https://demo.emulatorjs.org/roms/gb/Tetris%20(WW).gb",
      gbc:   "https://demo.emulatorjs.org/roms/gbc/Tetris%20DX%20(WW).gbc",
      gba:   "https://demo.emulatorjs.org/roms/gba/FlappyBird.gba",
      segaMD:"https://demo.emulatorjs.org/roms/megadrive/Columns%20(World).bin",
      segaMS:"https://demo.emulatorjs.org/roms/mastersystem/Snail%20Maze%20(World).sms",
      segaGG:"https://demo.emulatorjs.org/roms/gamegear/Sonic%20The%20Hedgehog.gg"
      // psx: (sem demo pÃºblica aqui; precisa ROM + BIOS)
    };

    // ===== ESTADO =====
    function currentCore(){
      // um core selecionado por grupo
      const nin  = coreNin.value;
      const seg  = coreSeg.value;
      const sony = coreSony.value;
      // prioridade: se usuÃ¡rio mexeu num grupo, use o Ãºltimo focado
      // mais simples: se PS1 selecionado, assume psx; senÃ£o use Sega se mudou; default Nintendo select
      if (document.activeElement === coreSony || sony === "psx") return "psx";
      if (document.activeElement === coreSeg) return seg;
      return nin;
    }

    function updateUI(){
      const core = currentCore();
      // Ajusta AR
      box.style.setProperty("--ar", ASPECT[core] || "4 / 3");
      // BIOS visÃ­vel sÃ³ no PS1
      biosRow.classList.toggle("hidden", core !== "psx");
      // Dica
      tipEl.textContent = HINT[core] || "";
    }

    coreNin.addEventListener("change", updateUI);
    coreSeg.addEventListener("change", updateUI);
    coreSony.addEventListener("change", updateUI);
    updateUI();

    // ===== CORE/LOADER =====
    function clearPlayer(){
      gameDiv.innerHTML = "";
      const old = document.getElementById("ejs-loader");
      if (old) old.remove();
    }

    async function startEmu(romUrl, core, opts={}){
      clearPlayer();

      // variÃ¡veis globais lidas pelo loader
      window.EJS_player        = "#game";
      window.EJS_core          = core;
      window.EJS_gameUrl       = romUrl;
      window.EJS_startOnLoaded = true;
      window.EJS_color         = "#111";
      window.EJS_pathtodata    = EJS_CDN;

      // BIOS (PS1)
      if (core === "psx" && opts.biosUrl){
        window.EJS_biosUrl = opts.biosUrl; // blob: URL do BIOS
      } else {
        window.EJS_biosUrl = undefined;
      }

      // injeta loader
      const s = document.createElement("script");
      s.src = EJS_CDN + "loader.js";
      s.id  = "ejs-loader";
      s.onerror = () => alert("Falha ao carregar o emulador (loader). Verifique conexÃ£o/bloqueio de CDN.");
      document.body.appendChild(s);
    }

    function maybeFullscreenOnMobile(){
      if (window.matchMedia("(max-width: 620px)").matches){
        const el = box;
        if (el.requestFullscreen) el.requestFullscreen();
      }
    }

    // ===== AÃ‡Ã•ES =====
    btnRun.addEventListener("click", () => {
      const file = romFile.files && romFile.files[0];
      if (!file){ alert("Escolha um arquivo de ROM primeiro."); return; }

      const core = currentCore();
      const romUrlObj = URL.createObjectURL(file);

      if (core === "psx"){
        const bios = (biosFile.files && biosFile.files[0]) || null;
        if (!bios){
          alert("PS1 requer BIOS (ex.: scph1001.bin). Selecione o arquivo BIOS.");
          return;
        }
        const biosUrl = URL.createObjectURL(bios);
        startEmu(romUrlObj, core, { biosUrl });
      } else {
        startEmu(romUrlObj, core);
      }
      maybeFullscreenOnMobile();
    });

    btnRunUrl.addEventListener("click", () => {
      const url = romUrl.value.trim();
      if (!/^https?:\/\//i.test(url)) { alert("Cole um link direto (http/https) para a ROM."); return; }

      const core = currentCore();
      if (core === "psx"){
        alert("PS1 via URL exige BIOS local. Selecione a BIOS no campo prÃ³prio e prefira ROM local/chd.");
        return;
      }
      startEmu(url, core);
      maybeFullscreenOnMobile();
    });

    btnDemo.addEventListener("click", () => {
      const core = currentCore();
      if (core === "psx"){
        alert("NÃ£o hÃ¡ demo pÃºblica de PS1 aqui. Use sua ROM + BIOS (scph1001.bin).");
        return;
      }
      const demo = DEMOS[core];
      if (!demo){ alert("Sem demo para este core."); return; }
      startEmu(demo, core);
      maybeFullscreenOnMobile();
    });

    btnFull.addEventListener("click", () => {
      if (box.requestFullscreen) box.requestFullscreen();
    });

    document.addEventListener('fullscreenchange', () => {
      document.body.style.overflow = document.fullscreenElement ? 'hidden' : '';
    });
  </script>
</body>
</html>
